<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AeroAI | Intelligent Assistant</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>A</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: #0a0a0a;
            color: #f5f5f5;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Animated Background */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }
        
        @keyframes float {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Welcome Page */
        .welcome-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(10, 10, 10, 0.95);
            z-index: 1000;
            transition: opacity 0.8s ease, transform 0.8s ease;
        }
        
        .welcome-content {
            text-align: center;
            max-width: 600px;
            padding: 2rem;
            animation: fadeInUp 1s ease;
        }
        
        .logo-large {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, #aaa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 4px;
        }
        
        .tagline {
            font-size: 1.2rem;
            color: #aaa;
            margin-bottom: 2rem;
            letter-spacing: 2px;
        }
        
        .start-button {
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            color: #f0f0f0;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #444;
            letter-spacing: 1px;
        }
        
        .start-button:hover {
            background: linear-gradient(135deg, #333 0%, #222 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }
        
        /* Chat Interface */
        .chat-interface {
            display: none;
            flex-direction: column;
            height: 100vh;
        }
        
        .header {
            background-color: rgba(10, 10, 10, 0.9);
            padding: 1.2rem 1.5rem;
            text-align: center;
            border-bottom: 1px solid #333;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            position: relative;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 300;
            letter-spacing: 2px;
            margin-bottom: 0.3rem;
            text-transform: uppercase;
        }
        
        .header p {
            color: #aaa;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }
        
        .logo {
            position: absolute;
            left: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.3rem;
            font-weight: 700;
            background: linear-gradient(to right, #fff, #ccc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            padding: 1rem;
            overflow: hidden;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background-color: rgba(20, 20, 20, 0.7);
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            backdrop-filter: blur(5px);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .message {
            max-width: 85%;
            padding: 0.9rem 1.2rem;
            border-radius: 18px;
            line-height: 1.5;
            animation: fadeIn 0.4s ease;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%);
            border-bottom-right-radius: 6px;
            color: #f0f0f0;
            border: 1px solid #444;
        }
        
        .bot-message {
            align-self: flex-start;
            background: linear-gradient(135deg, #1a1a1a 0%, #252525 100%);
            border-bottom-left-radius: 6px;
            color: #e8e8e8;
            border: 1px solid #3a3a3a;
        }
        
        /* Code Block Styles */
        .code-block {
            background: rgba(15, 15, 15, 0.9);
            border: 1px solid #444;
            border-radius: 8px;
            margin: 0.8rem 0;
            overflow: hidden;
        }
        
        .code-header {
            background: rgba(30, 30, 30, 0.9);
            padding: 0.6rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
            cursor: pointer;
        }
        
        .code-header:hover {
            background: rgba(40, 40, 40, 0.9);
        }
        
        .code-language {
            color: #888;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .code-toggle {
            color: #aaa;
            font-size: 0.9rem;
            transition: transform 0.3s ease;
        }
        
        .code-toggle.expanded {
            transform: rotate(180deg);
        }
        
        .code-content {
            display: none;
            padding: 1rem;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
            white-space: pre-wrap;
            color: #e8e8e8;
            background: rgba(10, 10, 10, 0.9);
        }
        
        .code-content.expanded {
            display: block;
        }
        
        /* Image Generation Styles */
        .generated-image-container {
            margin: 1rem 0;
            text-align: center;
        }
        
        .generated-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 12px;
            border: 2px solid #444;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .image-download-btn {
            margin-top: 0.8rem;
            padding: 0.6rem 1.2rem;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            color: #f0f0f0;
            border: 1px solid #444;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }
        
        .image-download-btn:hover {
            background: linear-gradient(135deg, #333 0%, #222 100%);
            transform: translateY(-2px);
        }
        
        .typing-indicator {
            align-self: flex-start;
            background: linear-gradient(135deg, #1a1a1a 0%, #252525 100%);
            padding: 0.9rem 1.2rem;
            border-radius: 18px;
            border-bottom-left-radius: 6px;
            color: #aaa;
            font-style: italic;
            border: 1px solid #3a3a3a;
            display: none;
        }
        
        .typing-dots {
            display: inline-block;
        }
        
        .typing-dots::after {
            content: '';
            animation: dots 1.5s steps(5, end) infinite;
        }
        
        .message-time {
            font-size: 0.65rem;
            color: #888;
            margin-top: 0.5rem;
            text-align: right;
        }
        
        .message-controls {
            display: flex;
            gap: 0.4rem;
            margin-top: 0.7rem;
            justify-content: flex-end;
        }
        
        .control-btn {
            background: rgba(60, 60, 60, 0.7);
            border: 1px solid #555;
            border-radius: 12px;
            color: #ddd;
            padding: 0.25rem 0.6rem;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.2rem;
        }
        
        .control-btn:hover {
            background: rgba(80, 80, 80, 0.7);
            transform: translateY(-1px);
        }
        
        .input-area {
            display: flex;
            gap: 0.8rem;
            padding: 1rem;
            background-color: rgba(20, 20, 20, 0.8);
            border-radius: 12px;
            border: 1px solid #333;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            align-items: center;
        }
        
        .input-area input {
            flex: 1;
            padding: 0.9rem 1.2rem;
            border: 1px solid #444;
            border-radius: 25px;
            background-color: rgba(30, 30, 30, 0.8);
            color: #f5f5f5;
            font-size: 0.95rem;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .input-area input:focus {
            border-color: #666;
            box-shadow: 0 0 0 2px rgba(100, 100, 100, 0.2);
        }
        
        .input-area input::placeholder {
            color: #777;
        }
        
        .input-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .icon-btn {
            background: rgba(60, 60, 60, 0.7);
            border: 1px solid #555;
            border-radius: 50%;
            color: #ddd;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .icon-btn:hover {
            background: rgba(80, 80, 80, 0.7);
            transform: translateY(-1px);
        }
        
        .icon-btn.active {
            background: rgba(80, 80, 80, 0.9);
            box-shadow: 0 0 0 2px rgba(100, 100, 100, 0.3);
        }
        
        .icon-btn.listening {
            animation: pulse 1.5s infinite;
        }
        
        .listening-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 12px;
            height: 12px;
            background: #ff4444;
            border-radius: 50%;
            animation: blink 1s infinite;
        }
        
        .send-btn {
            padding: 0.9rem 1.5rem;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            color: #f0f0f0;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #444;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .send-btn:hover {
            background: linear-gradient(135deg, #333 0%, #222 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        .send-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        
        /* Image Upload/Scan Styles */
        .image-upload-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .image-upload-content {
            background: rgba(30, 30, 30, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 1px solid #444;
        }
        
        .upload-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .upload-btn {
            padding: 1rem;
            border: 1px dashed #666;
            border-radius: 10px;
            background: rgba(40, 40, 40, 0.5);
            color: #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        
        .upload-btn:hover {
            background: rgba(50, 50, 50, 0.7);
            border-color: #888;
        }
        
        .close-btn {
            margin-top: 1rem;
            padding: 0.7rem 1.5rem;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            margin: 1rem 0;
            border-radius: 8px;
            display: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(100, 100, 100, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(100, 100, 100, 0); }
            100% { box-shadow: 0 0 0 0 rgba(100, 100, 100, 0); }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .footer {
            text-align: center;
            padding: 1rem;
            color: #666;
            font-size: 0.7rem;
            letter-spacing: 1px;
            border-top: 1px solid #222;
            background-color: rgba(10, 10, 10, 0.9);
        }
        
        .footer span {
            color: #888;
            font-weight: 600;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #444, #333);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, #555, #444);
        }
        
        /* Mobile-specific styles */
        .mobile-header {
            display: none;
            padding: 1rem;
            background-color: rgba(10, 10, 10, 0.9);
            border-bottom: 1px solid #333;
            text-align: center;
        }
        
        .mobile-logo {
            font-size: 1.3rem;
            font-weight: 700;
            background: linear-gradient(to right, #fff, #ccc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header {
                display: none;
            }
            
            .mobile-header {
                display: block;
            }
            
            .message {
                max-width: 90%;
                padding: 0.8rem 1rem;
            }
            
            .chat-container {
                padding: 0.8rem;
            }
            
            .input-area {
                padding: 0.8rem;
                flex-wrap: wrap;
            }
            
            .input-controls {
                order: -1;
                width: 100%;
                justify-content: center;
                margin-bottom: 0.5rem;
            }
            
            .chat-messages {
                padding: 0.8rem;
            }
            
            .logo-large {
                font-size: 3rem;
            }
            
            .tagline {
                font-size: 1rem;
            }
            
            .generated-image {
                max-height: 300px;
            }
        }
        
        @media (max-width: 480px) {
            .message {
                max-width: 95%;
                padding: 0.7rem 0.9rem;
            }
            
            .header h1 {
                font-size: 1.3rem;
            }
            
            .logo {
                position: relative;
                left: 0;
                margin-bottom: 0.5rem;
            }
            
            .logo-large {
                font-size: 2.5rem;
            }
            
            .welcome-content {
                padding: 1rem;
            }
            
            .icon-btn {
                width: 36px;
                height: 36px;
            }
            
            .generated-image {
                max-height: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="background">
        <div class="particles" id="particles"></div>
    </div>
    
    <!-- Welcome Page -->
    <div class="welcome-page" id="welcomePage">
        <div class="welcome-content">
            <div class="logo-large">AeroAI</div>
            <div class="tagline">INTELLIGENT CONVERSATIONAL ASSISTANT</div>
            <div class="loading-text" style="color: #888; margin-top: 1rem; font-size: 0.9rem;">
                Loading<span class="typing-dots"></span>
            </div>
        </div>
    </div>
    
    <!-- Image Upload/Scan Modal -->
    <div class="image-upload-container" id="imageUploadContainer">
        <div class="image-upload-content">
            <h3>Scan & Analyze</h3>
            <div class="upload-options">
                <div class="upload-btn" id="cameraBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                        <circle cx="12" cy="13" r="4"></circle>
                    </svg>
                    Use Camera
                </div>
                <div class="upload-btn" id="uploadBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    Upload Image
                </div>
            </div>
            <img id="imagePreview" class="image-preview" alt="Preview">
            <button class="close-btn" id="closeUpload">Cancel</button>
        </div>
    </div>
    
    <!-- Chat Interface -->
    <div class="chat-interface" id="chatInterface">
        <div class="mobile-header">
            <div class="mobile-logo">A</div>
        </div>
        
        <div class="header">
            <div class="logo">A</div>
            <h1>AEROAI ASSISTANT</h1>
            <p>Live conversation with image analysis</p>
        </div>
        
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <!-- Dynamic welcome message will be inserted here -->
            </div>
            
            <div class="input-area">
                <div class="input-controls">
                    <button class="icon-btn" id="startListening" title="Voice Input">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                    <button class="icon-btn" id="scanImageBtn" title="Scan & Search">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14,2 14,8 20,8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10,9 9,9 8,9"></polyline>
                        </svg>
                    </button>
                    <button class="icon-btn" id="toggleAutoSpeak" title="Auto-Speak: Off">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                        </svg>
                    </button>
                </div>
                
                <input type="text" id="userInput" placeholder="Type your message here..." autocomplete="off">
                
                <button class="send-btn" id="sendButton">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                    Send
                </button>
            </div>
        </div>
        
        <div class="footer">
            Powered by <span>TheAPIcalypse 2025</span> | AeroAI Interface
        </div>
    </div>

    <script>
        // DOM elements
        const welcomePage = document.getElementById('welcomePage');
        const chatInterface = document.getElementById('chatInterface');
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const currentTimeElement = document.getElementById('currentTime');
        const startListeningBtn = document.getElementById('startListening');
        const toggleAutoSpeakBtn = document.getElementById('toggleAutoSpeak');
        const scanImageBtn = document.getElementById('scanImageBtn');
        const imageUploadContainer = document.getElementById('imageUploadContainer');
        const cameraBtn = document.getElementById('cameraBtn');
        const uploadBtn = document.getElementById('uploadBtn');
        const closeUpload = document.getElementById('closeUpload');
        const imagePreview = document.getElementById('imagePreview');
        const particlesContainer = document.getElementById('particles');
        
        // State variables
        let isListening = false;
        let autoSpeakEnabled = false;
        let recognition = null;
        let lastBotResponse = '';
        let currentImage = null;
        let welcomePageLoaded = false;
        let silenceTimeout = null;
        let isVoiceInput = false;
        
        // Dynamic welcome messages with emojis
        const welcomeMessages = [
            "üëã Hello! I'm AeroAI, your intelligent assistant. How can I help you today?",
            "üòä Hi there! I'm here to assist you with anything you need. What's on your mind?",
            "üåü Welcome! I'm AeroAI, ready to help with your questions and tasks. How can I assist you?",
            "üéâ Hey! Great to see you. I'm AeroAI - your AI assistant. What can I do for you?",
            "üí´ Hello! I'm AeroAI, your personal assistant. How may I be of service today?",
            "ü§ñ Hi! I'm here to help with information, tasks, or just a friendly chat. What would you like to know?",
            "üöÄ Welcome back! I'm AeroAI, your intelligent companion. How can I assist you today?",
            "üí° Greetings! I'm AeroAI, ready to help you with anything from questions to creative tasks.",
            "üå† Hello there! I'm your AeroAI assistant. What would you like to explore today?",
            "‚ú® Hi! I'm AeroAI, here to make your day easier. What can I help you with?"
        ];

        // Emotional responses mapping
        const emotionalResponses = {
            'happy': ['üòä', 'üéâ', 'üåü', 'üòÑ', 'ü§ó'],
            'helpful': ['üí°', 'üîç', 'ü§ù', 'üëç', 'üí´'],
            'thinking': ['ü§î', 'üí≠', 'üß†', 'üîé'],
            'success': ['‚úÖ', 'üéØ', 'üèÜ', '‚ú®'],
            'error': ['üòÖ', '‚ö†Ô∏è', 'üîÑ', 'üôè'],
            'code': ['üíª', '‚ö°', 'üîß', 'üõ†Ô∏è'],
            'creative': ['üé®', 'üìù', '‚ú®', 'üí´'],
            'learning': ['üìö', 'üéì', 'üîç', 'üí°'],
            'image': ['üñºÔ∏è', 'üé®', 'üì∏', '‚ú®']
        };

        // Image generation triggers
        const imageGenerationTriggers = [
            'generate image', 'create image', 'make picture', 'draw', 'generate picture',
            'create picture', 'make image', 'generate art', 'create art', 'make art',
            'generate photo', 'create photo', 'make photo', 'generate illustration',
            'create illustration', 'make illustration', 'generate drawing', 'create drawing'
        ];
        
        // Create animated background particles
        function createParticles() {
            const particleCount = 25;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                // Random properties
                const size = Math.random() * 3 + 1;
                const posX = Math.random() * 100;
                const delay = Math.random() * 15;
                const duration = Math.random() * 10 + 15;
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${posX}%`;
                particle.style.bottom = `-10px`;
                particle.style.animationDelay = `${delay}s`;
                particle.style.animationDuration = `${duration}s`;
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // Set initial time
        function updateTime() {
            const now = new Date();
            currentTimeElement.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        // Get random welcome message
        function getRandomWelcomeMessage() {
            const randomIndex = Math.floor(Math.random() * welcomeMessages.length);
            return welcomeMessages[randomIndex];
        }
        
        // Auto-dismiss welcome page
        function dismissWelcomePage() {
            if (welcomePageLoaded) {
                welcomePage.style.opacity = '0';
                welcomePage.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    welcomePage.style.display = 'none';
                    chatInterface.style.display = 'flex';
                    // Add random welcome message when chat starts
                    addWelcomeMessage();
                    userInput.focus();
                }, 800);
            }
        }
        
        // Add welcome message to chat
        function addWelcomeMessage() {
            const welcomeMessage = getRandomWelcomeMessage();
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot-message';
            
            const time = new Date();
            const timeString = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                ${welcomeMessage}
                <div class="message-time">${timeString}</div>
                <div class="message-controls">
                    <button class="control-btn speak-message">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                        </svg>
                        Speak
                    </button>
                    <button class="control-btn copy-message">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        Copy
                    </button>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Add event listeners to control buttons
            const speakBtn = messageDiv.querySelector('.speak-message');
            speakBtn.addEventListener('click', () => {
                speakText(welcomeMessage);
            });
            
            const copyBtn = messageDiv.querySelector('.copy-message');
            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(welcomeMessage).then(() => {
                    // Visual feedback for copy
                    copyBtn.innerHTML = `
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Copied!
                    `;
                    setTimeout(() => {
                        copyBtn.innerHTML = `
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy
                        `;
                    }, 2000);
                });
            });
        }
        
        // Format code blocks with proper indentation
        function formatCodeBlock(content, language = 'javascript') {
            // Clean and format the code
            const formattedCode = content
                .replace(/```[\w]*\n?/g, '') // Remove code block markers
                .replace(/```/g, '')
                .trim();
            
            const codeBlock = document.createElement('div');
            codeBlock.className = 'code-block';
            
            codeBlock.innerHTML = `
                <div class="code-header">
                    <span class="code-language">${language.toUpperCase()}</span>
                    <span class="code-toggle">‚ñº</span>
                </div>
                <div class="code-content">
${formattedCode}
                </div>
            `;
            
            // Add toggle functionality
            const header = codeBlock.querySelector('.code-header');
            const contentDiv = codeBlock.querySelector('.code-content');
            const toggle = codeBlock.querySelector('.code-toggle');
            
            header.addEventListener('click', () => {
                contentDiv.classList.toggle('expanded');
                toggle.classList.toggle('expanded');
            });
            
            return codeBlock;
        }

        // Add emotional emoji to response
        function addEmotionalEmoji(text, emotion = 'helpful') {
            const emojis = emotionalResponses[emotion] || emotionalResponses.helpful;
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            // Detect if it's a code response
            if (text.includes('```') || text.toLowerCase().includes('code') || 
                text.toLowerCase().includes('function') || text.toLowerCase().includes('const ')) {
                const codeEmojis = emotionalResponses.code;
                return `${codeEmojis[Math.floor(Math.random() * codeEmojis.length)]} ${text}`;
            }
            
            // Detect if it's an image generation response
            if (text.toLowerCase().includes('image') || text.toLowerCase().includes('picture') || 
                text.toLowerCase().includes('art') || text.toLowerCase().includes('generate')) {
                const imageEmojis = emotionalResponses.image;
                return `${imageEmojis[Math.floor(Math.random() * imageEmojis.length)]} ${text}`;
            }
            
            return `${randomEmoji} ${text}`;
        }

        // Check if message is requesting image generation
        function isImageGenerationRequest(message) {
            const lowerMessage = message.toLowerCase();
            return imageGenerationTriggers.some(trigger => lowerMessage.includes(trigger));
        }

        // Generate image using DALL-E API (simulated for demo)
        async function generateImage(prompt) {
            showTypingIndicator();
            
            try {
                // In a real implementation, you would use:
                // const response = await fetch('https://api.openai.com/v1/images/generations', {
                //     method: 'POST',
                //     headers: {
                //         'Authorization': 'Bearer YOUR_DALL_E_API_KEY',
                //         'Content-Type': 'application/json'
                //     },
                //     body: JSON.stringify({
                //         prompt: prompt,
                //         n: 1,
                //         size: "1024x1024"
                //     })
                // });
                
                // For demo purposes, we'll simulate the API call
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Return a demo image URL (in real implementation, use the URL from DALL-E response)
                const demoImages = [
                    'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=400&h=400&fit=crop',
                    'https://images.unsplash.com/photo-1550684376-efcbd6e3f031?w=400&h=400&fit=crop',
                    'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=400&fit=crop',
                    'https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=400&h=400&fit=crop'
                ];
                
                const randomImage = demoImages[Math.floor(Math.random() * demoImages.length)];
                return randomImage;
                
            } catch (error) {
                console.error('Error generating image:', error);
                throw new Error('Failed to generate image. Please try again.');
            } finally {
                hideTypingIndicator();
            }
        }

        // Download image function
        function downloadImage(imageUrl, filename) {
            const link = document.createElement('a');
            link.href = imageUrl;
            link.download = filename || 'generated-image.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Create image message with download button
        function createImageMessage(imageUrl, prompt) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot-message';
            
            const time = new Date();
            const timeString = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const filename = `aeroai-${Date.now()}.png`;
            
            messageDiv.innerHTML = `
                üé® Here's the image I generated based on your prompt: "${prompt}"
                <div class="generated-image-container">
                    <img src="${imageUrl}" alt="Generated image" class="generated-image">
                    <button class="image-download-btn" onclick="downloadImage('${imageUrl}', '${filename}')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Download Image
                    </button>
                </div>
                <div class="message-time">${timeString}</div>
                <div class="message-controls">
                    <button class="control-btn copy-message">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        Copy Prompt
                    </button>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Add copy functionality for the prompt
            const copyBtn = messageDiv.querySelector('.copy-message');
            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(prompt).then(() => {
                    copyBtn.innerHTML = `
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Copied!
                    `;
                    setTimeout(() => {
                        copyBtn.innerHTML = `
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy Prompt
                        `;
                    }, 2000);
                });
            });
            
            return messageDiv;
        }
        
        // API configuration
        const API_KEY = 'AIzaSyANyvyftAGbiBYCF5Z2V9W7EWTSSB2Nr5o';
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;
        
        // Clean text formatting (remove * and other markdown)
        function cleanText(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '$1')  // Remove **bold**
                .replace(/\*(.*?)\*/g, '$1')       // Remove *italic*
                .replace(/\n{3,}/g, '\n\n')        // Replace 3+ newlines with 2
                .trim();
        }
        
        // Add message to chat - FIXED VERSION
        function addMessage(content, isUser, isImage = false, isVoiceInput = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            const time = new Date();
            const timeString = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            let messageContent = '';
            
            if (isImage) {
                messageContent = `<div style="margin-bottom: 0.5rem;"><strong>üì∏ Image Analysis Request</strong></div>`;
            } else if (content.includes('```')) {
                // Extract code blocks and format them
                const parts = content.split(/```(\w+)?\n/);
                let processedContent = '';
                
                for (let i = 0; i < parts.length; i++) {
                    if (i % 2 === 0) {
                        // Regular text - add emotional emoji to first part
                        const text = cleanText(parts[i]);
                        if (i === 0 && text.trim().length > 0 && !isUser) {
                            processedContent += addEmotionalEmoji(text);
                        } else {
                            processedContent += text;
                        }
                    } else {
                        // Code block
                        const language = parts[i] || 'text';
                        const codeContent = parts[i + 1] || '';
                        const codeBlock = formatCodeBlock(codeContent, language);
                        processedContent += codeBlock.outerHTML;
                        i++; // Skip the next part since we used it as code content
                    }
                }
                
                messageContent = processedContent;
            } else {
                const cleanedText = cleanText(content);
                messageContent = isUser ? cleanedText : addEmotionalEmoji(cleanedText);
            }
            
            let controlsHTML = '';
            if (!isUser) {
                controlsHTML = `
                    <div class="message-controls">
                        <button class="control-btn speak-message">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                            </svg>
                            Speak
                        </button>
                        <button class="control-btn copy-message">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy
                        </button>
                    </div>
                `;
            } else {
                controlsHTML = `
                    <div class="message-controls">
                        <button class="control-btn copy-message">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy
                        </button>
                    </div>
                `;
            }
            
            messageDiv.innerHTML = `
                ${messageContent}
                <div class="message-time">${timeString}</div>
                ${controlsHTML}
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Add event listeners to control buttons - FIXED: Properly link with the actual content
            if (!isUser) {
                const speakBtn = messageDiv.querySelector('.speak-message');
                speakBtn.addEventListener('click', () => {
                    speakText(content);
                });
                
                // Auto-speak if it was a voice input
                if (isVoiceInput && autoSpeakEnabled) {
                    setTimeout(() => {
                        speakText(content);
                    }, 500);
                }
            }
            
            const copyBtn = messageDiv.querySelector('.copy-message');
            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(content).then(() => {
                    // Visual feedback for copy
                    copyBtn.innerHTML = `
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Copied!
                    `;
                    setTimeout(() => {
                        copyBtn.innerHTML = `
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy
                        `;
                    }, 2000);
                });
            });
            
            return messageDiv;
        }
        
        // Show typing indicator inside chat
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `ü§î AeroAI is thinking<span class="typing-dots"></span>`;
            typingDiv.style.display = 'block';
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Hide typing indicator
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        // Send message to Gemini API
        async function sendMessageToGemini(message, isImageRequest = false) {
            showTypingIndicator();
            
            try {
                let requestBody = {
                    contents: [{
                        parts: [{
                            text: isImageRequest ? 
                                `Please analyze this image and respond to: "${message}". Describe what you see and provide relevant information.` : 
                                message
                        }]
                    }]
                };
                
                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    throw new Error('Unexpected API response format');
                }
            } catch (error) {
                console.error('Error calling API:', error);
                return `üòÖ I apologize, but I'm experiencing technical difficulties at the moment. Please try again shortly.`;
            } finally {
                hideTypingIndicator();
            }
        }
        
        // Convert text to speech using browser's speech synthesis
        async function speakText(text) {
            try {
                if ('speechSynthesis' in window) {
                    // Stop any ongoing speech
                    window.speechSynthesis.cancel();
                    
                    // Remove emojis and code blocks for speech
                    const cleanSpeechText = text.replace(/[^\w\s.,!?;:/()-]/g, '').replace(/```[\s\S]*?```/g, 'code example');
                    
                    const utterance = new SpeechSynthesisUtterance(cleanSpeechText);
                    
                    // Configure voice settings
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    utterance.volume = 0.8;
                    
                    // Select a voice
                    const voices = speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        // Prefer a natural-sounding voice
                        const preferredVoice = voices.find(voice => 
                            voice.name.includes('Google') || 
                            voice.name.includes('Samantha') || 
                            voice.name.includes('Microsoft')
                        );
                        utterance.voice = preferredVoice || voices[0];
                    }
                    
                    window.speechSynthesis.speak(utterance);
                } else {
                    alert('Text-to-speech is not supported in your browser. Please try a modern browser like Chrome or Edge.');
                }
            } catch (error) {
                console.error('Error with text-to-speech:', error);
                alert('There was an error with the voice synthesis. Please try again.');
            }
        }
        
        // Initialize speech recognition
        function initSpeechRecognition() {
            // Check if browser supports speech recognition
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('Speech recognition is not supported in your browser. Please try Chrome or Edge.');
                return false;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-US';
            
            recognition.onstart = function() {
                console.log('Speech recognition started');
                isListening = true;
                isVoiceInput = true;
                startListeningBtn.classList.add('listening');
                startListeningBtn.classList.add('active');
                
                // Add listening indicator
                const indicator = document.createElement('div');
                indicator.className = 'listening-indicator';
                startListeningBtn.appendChild(indicator);
                
                // Start silence timeout
                resetSilenceTimeout();
            };
            
            recognition.onresult = function(event) {
                console.log('Speech result received');
                // Reset silence timeout on any result
                resetSilenceTimeout();
                
                let finalTranscript = '';
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }
                
                // Update input with interim results
                if (interimTranscript) {
                    userInput.value = interimTranscript;
                }
                
                // If we have final results, submit
                if (finalTranscript) {
                    userInput.value = finalTranscript;
                    setTimeout(() => {
                        handleSendMessage();
                    }, 500);
                }
            };
            
            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                if (event.error === 'no-speech') {
                    // This is handled by our silence timeout
                    return;
                }
                resetListeningButton();
            };
            
            recognition.onend = function() {
                console.log('Speech recognition ended');
                // Only reset if not manually stopped
                if (isListening) {
                    resetListeningButton();
                }
            };
            
            return true;
        }
        
        // Reset silence timeout
        function resetSilenceTimeout() {
            if (silenceTimeout) {
                clearTimeout(silenceTimeout);
            }
            silenceTimeout = setTimeout(() => {
                if (isListening) {
                    console.log('Silence timeout - stopping recognition');
                    recognition.stop();
                    resetListeningButton();
                    // Show a message that listening stopped due to silence
                    addMessage("üé§ Listening stopped due to silence. Tap the microphone to try again.", false);
                }
            }, 5000); // 5 seconds of silence
        }
        
        function resetListeningButton() {
            isListening = false;
            startListeningBtn.classList.remove('listening');
            startListeningBtn.classList.remove('active');
            
            // Remove listening indicator
            const indicator = startListeningBtn.querySelector('.listening-indicator');
            if (indicator) {
                indicator.remove();
            }
            
            // Clear silence timeout
            if (silenceTimeout) {
                clearTimeout(silenceTimeout);
                silenceTimeout = null;
            }
        }
        
        // Handle sending a message - FIXED: Proper message flow
        async function handleSendMessage(isImageRequest = false) {
            const message = userInput.value.trim();
            
            if (!message && !isImageRequest) return;
            
            // Add user message to chat
            if (isImageRequest) {
                addMessage("üì∏ I'd like to analyze an image", true, true);
            } else {
                addMessage(message, true, false, isVoiceInput);
            }
            
            userInput.value = '';
            
            // Check if this is an image generation request
            if (isImageGenerationRequest(message)) {
                try {
                    addMessage("üé® Generating your image... Please wait!", false);
                    const imageUrl = await generateImage(message);
                    createImageMessage(imageUrl, message);
                    
                    // Auto-speak if enabled and it was a voice input
                    if (autoSpeakEnabled && isVoiceInput) {
                        setTimeout(() => {
                            speakText("I've generated an image based on your request. You can download it using the download button.");
                        }, 500);
                    }
                } catch (error) {
                    addMessage(`üòÖ Sorry, I couldn't generate the image. ${error.message}`, false);
                }
            } else {
                // Get response from Gemini
                const response = await sendMessageToGemini(message, isImageRequest);
                lastBotResponse = response;
                
                // Add bot response to chat - FIXED: Properly link the response
                const botMessageDiv = addMessage(response, false, false, isVoiceInput);
                
                // Auto-speak if enabled and it was a voice input
                if (autoSpeakEnabled && isVoiceInput) {
                    setTimeout(() => {
                        speakText(response);
                    }, 500);
                }
            }
            
            isVoiceInput = false;
        }
        
        // Handle image upload
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    currentImage = e.target.result;
                    
                    // Auto-close the upload modal after a delay
                    setTimeout(() => {
                        imageUploadContainer.style.display = 'none';
                        handleSendMessage(true);
                    }, 1000);
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Handle camera access
        function handleCameraAccess() {
            alert("üì∑ Camera access would be implemented here. For this demo, please use the upload option.");
        }
        
        // Event listeners
        window.addEventListener('load', function() {
            welcomePageLoaded = true;
            // Auto-dismiss after 3 seconds or immediately if page is ready
            setTimeout(dismissWelcomePage, 3000);
        });
        
        sendButton.addEventListener('click', () => handleSendMessage(false));
        
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleSendMessage(false);
            }
        });
        
        startListeningBtn.addEventListener('click', () => {
            if (!isListening) {
                console.log('Starting voice recognition...');
                if (recognition) {
                    recognition.start();
                } else {
                    if (initSpeechRecognition()) {
                        recognition.start();
                    }
                }
            } else {
                console.log('Stopping voice recognition...');
                if (recognition) {
                    recognition.stop();
                }
                resetListeningButton();
            }
        });
        
        toggleAutoSpeakBtn.addEventListener('click', () => {
            autoSpeakEnabled = !autoSpeakEnabled;
            toggleAutoSpeakBtn.title = `Auto-Speak: ${autoSpeakEnabled ? 'On' : 'Off'}`;
            
            if (autoSpeakEnabled) {
                toggleAutoSpeakBtn.classList.add('active');
            } else {
                toggleAutoSpeakBtn.classList.remove('active');
            }
        });
        
        scanImageBtn.addEventListener('click', () => {
            imageUploadContainer.style.display = 'flex';
        });
        
        cameraBtn.addEventListener('click', handleCameraAccess);
        
        uploadBtn.addEventListener('click', () => {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.onchange = handleImageUpload;
            fileInput.click();
        });
        
        closeUpload.addEventListener('click', () => {
            imageUploadContainer.style.display = 'none';
            imagePreview.style.display = 'none';
            currentImage = null;
        });
        
        // Initialize the app
        createParticles();
        updateTime();
        setInterval(updateTime, 60000);
        
        // Fallback: If page takes too long to load, dismiss welcome page after 5 seconds
        setTimeout(() => {
            if (welcomePage.style.display !== 'none') {
                dismissWelcomePage();
            }
        }, 5000);

        // Initialize speech recognition on load
        initSpeechRecognition();

        // Make downloadImage function available globally for the download button
        window.downloadImage = downloadImage;
    </script>
</body>
</html>
